import{a as K}from"./QB2T4ZIR.js";import{a as k,b as G}from"./MBTV4455.js";import{b as C,c as H}from"./GRG36H53.js";import{B as D,C as B,D as U,E as q,G as $}from"./QCV2OUCP.js";import{a as m,g as L,h as O,i as d}from"./CORDBAGF.js";import{c as E}from"./KHKEWIY7.js";import{F as N,w as A}from"./JGNRUIUO.js";import{Ca as b,ja as M}from"./HQXZBLYX.js";import{Q as R,Sb as _,ka as p,kb as F,qa as v,s as T,za as P}from"./5XNCO7TL.js";import{a as I}from"./PJ57C2TE.js";import{f as x}from"./GAV6HCJA.js";var w=x(I());var V=async(t,e)=>(t&&t.contentWindow,new Promise(async n=>{let i=new m,o=p();(await i.postMessage({event:"Client_findIframePageCitation",data:{taskId:o,citation:e}})).success||n(!1);let r=setTimeout(()=>{n(!1),w.default.runtime.onMessage.removeListener(s)},1e4),s=c=>{c.id===E&&c.event==="Client_listenFindIframePageCitationResponse"&&c.data.taskId===o&&(n(c.data.isMatched),w.default.runtime.onMessage.removeListener(s),clearTimeout(r))};w.default.runtime.onMessage.addListener(s)}));var g=x(I());var j=async()=>{if(P())return"";let t=v(),e=typeof window<"u"?window.location.href:"",n="";return t==="docs.google.com"?n=await z():t==="github.com"?n=await Z():e.match("onedrive.live.com/edit")||e.match(/onedrive\.live\.com\/personal\/[^/]+\/.*\.aspx/)||e.match("word.cloud.microsoft/open/onedrive")?n=await S():e.match("icloud.com/mail")?n=await S():e.match("navigator-lxa.mail.com/mail")&&(n=await S()),n.trim()},X=async(t,e)=>(t&&t.contentWindow,new Promise(async n=>{let i=new m,o=p();(await i.postMessage({event:"Client_createIframePageDocument",data:{taskId:o,pageUrl:e}})).success||n(null);let r=setTimeout(()=>{n(null),g.default.runtime.onMessage.removeListener(s)},1e4),s=async c=>{if(c.id===E&&c.event==="Client_listenCreateIframePageDocumentResponse"&&c.data.taskId===o){let l=c.data.pageDocument,u=await F.createDocFile(l.doc_type,l.doc_type_dependent_data||{},l.doc_type==="page_content__webpage"?{pureText:l.pure_text}:void 0);n({...l,file:u}),g.default.runtime.onMessage.removeListener(s),clearTimeout(r)}};g.default.runtime.onMessage.addListener(s)})),S=async()=>new Promise(async t=>{let e=new m,n=p();(await e.postMessage({event:"Client_getIframePageContent",data:{taskId:n}})).success||t("");let o=setTimeout(()=>{t(""),g.default.runtime.onMessage.removeListener(a)},1e4),a=r=>{r.id===E&&r.event==="Client_listenGetIframePageContentResponse"&&r.data.taskId===n&&(t(r.data.pageContent),g.default.runtime.onMessage.removeListener(a),clearTimeout(o))};g.default.runtime.onMessage.addListener(a)}),z=async()=>new Promise(t=>{let e=p(),n=setTimeout(()=>{t(""),window.removeEventListener(`${e}-result`,i)},1e4),i=o=>{t(o.detail.pageContent),clearTimeout(n)};window.addEventListener(`${e}-result`,i,{once:!0}),window.dispatchEvent(new CustomEvent("MAXAI_LOAD_GOOGLE_DOC_CONTENT",{detail:{id:e}}))}),Z=async()=>{let t=new URL(location.href),e=t.pathname,n=e.split("/")[1],i=e.split("/")[2];if(document.querySelector("#copilot-button-positioner")){let o=e.split("/").pop(),a="";a+=`## File Information
`,a+=`- Repository Name: [${i}](${t.origin}/${n}/${i})
`,a+=`- File Name: ${o}
`,a+=`- File Path: ${e}
`,a+=`- File Source link: ${t.href}
`,a+=`## File Content
`;let r="N/A",s=document.querySelector('a[data-testid="raw-button"]'),c="";if(s){let l=await C(s.href,{method:"GET",parse:"text"});l?.success&&(r=l.data||"N/A");let u=s.href.split("/").pop();c=R(u?.split(".").pop()||"")}return a+=`\`\`\`${c}
${r}
\`\`\`
`,a}else if(/issues\/\d+/.test(e)){let o=s=>{if(!s)return{author:"",date:"",content:"",metadata:""};let c=s.querySelector("a.author"),l=s.querySelector("relative-time"),u=s.querySelector(".user-select-contain")||s.querySelector("table"),f=s.querySelector(".timeline-comment-header div > span > span");return{author:c?.innerText||"",date:l?.getAttribute("datetime")||l?.title||"",content:u?.innerText.replace(/\n\s+/g,`
`).replace(/\n{2,}/g,`

`).trim()||"N/A",metadata:f?.innerText||"Commenters"}},a=document.querySelector(".js-issue-title"),r=document.querySelector(".js-discussion > div");if(r){let s=[o(r)],c=new URL(window.location.href);c.pathname=c.pathname+"/partials/load_more";let l=await C(c.href,{method:"GET",parse:"text"});l?.success&&new DOMParser().parseFromString(l?.data||"","text/html").querySelectorAll(".js-timeline-item").forEach(Q=>{s.push(o(Q))});let u="";return u+=`## ${a?.innerText}
`,u+=`- Repository Name: [${i}](${t.origin}/${n}/${i})
`,u+=`- Repository issue link: ${t.href}
`,s.forEach((f,h)=>{u+=`### Comment ${h+1}
`,u+=`- Author: ${f.author}
`,u+=`- Date: ${f.date}
`,u+=`- Metadata: ${f.metadata}
`,u+=`${f.content}
`}),u}}return""};var ee=async(t,e)=>(await new m({runtime:"shortcut"}).postMessage({event:"ShortCuts_OperationPageElement",data:{OperationElementConfig:e,OperationElementTabID:t}})).data,W=ee;var te=async()=>{let t="MAXAI_CURRENT_TAB_NET_REQUEST_SESSION_RULE_ID",e=Number(await T.getItem(t))||1e3;return e>2e4&&(e=1e3),await T.setItem(t,e+1),e},Y=async t=>{let i=(await d("tabs","query",[{active:!0,currentWindow:!0}]))?.[0]?.id;if(!i)return!1;if(t.addRules){t.addRules=t.addRules.map(r=>_([r,{condition:{tabIds:[i]}}]));let a=await d("declarativeNetRequest","getSessionRules",[]);a?.length&&(t.addRules=t.addRules.filter(r=>!a.find(c=>M(r,{...c,id:r.id}))));for(let r of t.addRules)r.id=await te()}let o=await d("declarativeNetRequest","updateSessionRules",[t]);return!0},J=async()=>{let n=(await d("tabs","query",[{active:!0,currentWindow:!0}]))?.[0]?.id;if(!n)return!1;let o=(await d("declarativeNetRequest","getSessionRules",[]))?.filter(r=>r.condition.tabIds?.includes(n));if(!o?.length)return!0;let a=await d("declarativeNetRequest","updateSessionRules",[{removeRuleIds:o.map(r=>r.id)}]);return!0};var ne=async t=>(await new m({runtime:"client"}).postMessage({event:"Client_syncAuthInfo",data:t})).data,y=class{constructor(){this.openPage=L;this.closePage=O;this.proxyFetch=C;this.abortProxyFetch=H;this.getSpecialHostPageContent=j;this.operationPageElement=W;this.showSidebar=k;this.hideSidebar=G;this.createFileStreamer=async(e,n)=>{let o=await new m({runtime:"client"}).postMessage({event:"Client_createFileStreamer",data:{fileUrl:e,chunkSize:n}});return o.success?o.data:new Error(o.message)};this.destroyFileStreamer=async e=>(await new m({runtime:"client"}).postMessage({event:"Client_destroyFileStreamer",data:{taskId:e}})).data;this.getFileNextChunk=async(e,n)=>(await new m({runtime:"client"}).postMessage({event:"Client_getFileNextChunk",data:{taskId:e,chunkSize:n}})).data;this.updateCurrentTabNetRequestSessionRules=Y;this.clearCurrentTabNetRequestSessionRules=J;this.syncUserTokens=ne;this.injectScript=async(e,n)=>new Promise(i=>{let o=p(),a=setTimeout(()=>{i(null),window.removeEventListener(`${o}-result`,r)},2e3),r=()=>{i(!0),clearTimeout(a)};window.addEventListener(`${o}-result`,r,{once:!0}),window.dispatchEvent(new CustomEvent("MAXAI_INJECT_SCRIPT",{detail:{id:o,src:e,attrs:n}}))});this.pingIframePage=async()=>!0;this.findIframePageCitation=V;this.createIframePageDocument=X;this.getExtensionPinedStatus=async()=>(await d("action","getUserSettings",[]))?.isOnToolbar||!1;this.getExtensionPublicConfig=async()=>({onboardingMap:await $(),currentActiveModalKey:D,currentActiveTopBarKey:B,currentUploadModalKey:U,currentTourKey:q});this.checkSettingsUpdate=async()=>{try{return await A.isLogin()?(await N.getAppSettings(!0),!0):!1}catch{return!1}};this.getCurrentTabScreenshot=K}async setPricingClosedRedirectUrl(...e){return new m({runtime:"client"}).postMessage({event:"Client_createPaymentUrl",data:e[0]}),!0}};function Xe(){b(y)}export{ne as a,Xe as b};
